#!/bin/sh

# BUILD_DIR CACHE_DIR ENV_DIR

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3
BP_DIR=`cd $(dirname $0); cd ..; pwd`

echo "-----> Found a hello.txt"
echo "BUILD_DIR $BUILD_DIR"
echo "CACHE_DIR $CACHE_DIR"
echo "ENV_DIR $ENV_DIR"
echo "BP_DIR $BP_DIR"

echo "GIT_BRANCH: $(git branch)"
export "GIT_BRANCH=$(git branch)"
echo "exported GIT_BRANCH: $GIT_BRANCH"

echo "$GIT_BRANCH" > "$2/GIT_BRANCH"
echo "Added GIT_BRANCH to variables"
cat $2/GIT_BRANCH

indent() {
  sed -u 's/^/       /'
}

# if hello.txt has contents, display them (indented to align)
# otherwise error

if [ ! -s $1/hello.txt ]; then
  echo "hello.txt was empty"
  exit 1
else
  echo "hello.txt is not empty, here are the contents" | indent
  cat $1/hello.txt
fi | indent


profile_d_dir="$BUILD_DIR/.profile.d"
mkdir -p "$profile_d_dir"
cp "$BP_DIR/.profile.d/add-git-branch-env.sh" "$profile_d_dir/"